<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Player Lock Screen</title>
    <link rel="stylesheet" href="../styles/components/media-player.css">
    <style>
        :root {
            --widget-width: 20rem;
            --widget-height: 12rem;
        }

        body {
            background-color: oklch(from #1a1a1a l c h) !important;
            margin: 0;
            display: grid;
            place-items: center;
            min-height: 100vh;
        }

        .media-player-grid {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: .5rem;
            inline-size: var(--widget-width);
            background: linear-gradient(oklch(from #2a2a2a l c h / 0.8), oklch(from #2a2a2a l c h / 0.8)), var(--bg-image, none);
            background-size: cover;
            background-position: center;
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            border: 1px solid oklch(from #444 l c h / 0.5);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: background-image 0.5s ease-in-out;
        }

        .media-player-grid__row {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            width: 100%;
            align-items: center;
        }

        /* Row 1 Content */
        .grid-item--yt {
            grid-column: 1;
        }

        .grid-item--phone {
            grid-column: 8;
        }

        /* Row 2 Content */
        .media-player__meta {
            grid-column: 1 / 5;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 0.125rem;
            padding-inline-start: 0.25rem;
        }

        .media-player__play-pause {
            grid-column: 8;
        }

        /* Row 3 Content */
        .media-player__prev {
            grid-column: 1;
        }

        .media-player__progress {
            grid-column: 2 / 6;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .media-player__next {
            grid-column: 6;
        }

        .media-player__like {
            grid-column: 7;
        }

        .media-player__random {
            grid-column: 8;
        }

        /* Custom Styles for Icons/Buttons */
        .media-player-grid button {
            background: transparent;
            border: none;
            border-radius: 0.75rem;
            color: white;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            inline-size: 2rem;
            block-size: 2rem;
            aspect-ratio: 1;
        }

        .media-player-grid button:hover {
            background: oklch(from #444 l c h);
            transform: translateY(-1px);
        }

        .media-player-grid button:active {
            transform: translateY(0);
        }

        .media-player-grid .themed-background {
            background: var(--themed-background, oklch(from #007bff l c h));
            border-radius: 1rem;
            transition: background-color 0.5s ease;
        }

        .media-player-grid .themed-background:hover {
            background: oklch(from #0056b3 l c h);
        }

        /* Meta Styles */
        .media-player__meta__title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #fff;
        }

        .media-player__meta__artist {
            font-size: 0.75rem;
            color: #aaa;
        }

        .media-player__meta__album {
            font-size: 0.65rem;
            color: #777;
        }

        /* Slider Reset */
        .progress-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: #444;
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        .progress-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #007bff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 4px rgba(0, 123, 255, 0.5);
        }

        /* SVG Sizing */
        svg {
            inline-size: 20px;
            block-size: 20px;
            fill: currentColor;
        }

        .icon-btn--brand svg {
            fill: oklch(from #fff l c h / 0.8);
        }
    </style>
</head>

<body>

    <section class="media-player-grid">
        <!-- Row 1 -->
        <article class="media-player-grid__row">
            <button class="grid-item--yt icon-btn--brand themed-background" title="YouTube Music">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2.5-12.5v9l7.5-4.5-7.5-4.5z" />
                </svg>
            </button>
            <button class="grid-item--phone icon-btn--brand themed-background" title="This Phone">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 18H7V5h10v14z" />
                </svg>
            </button>
        </article>

        <!-- Row 2 -->
        <article class="media-player-grid__row">
            <div class="media-player__meta">
                <div class="media-player__meta__title">Loading...</div>
                <div class="media-player__meta__artist">...</div>
                <div class="media-player__meta__album">...</div>
            </div>
            <button class="media-player__play-pause themed-background" title="Play">
                <svg viewBox="0 -960 960 960">
                    <path d="M320-200v-560l440 280-440 280Zm80-280Zm0 134 210-134-210-134v268Z" />
                </svg>
            </button>
        </article>

        <!-- Row 3 -->
        <article class="media-player-grid__row">
            <button class="media-player__prev" title="Previous">
                <svg viewBox="0 -960 960 960">
                    <path d="M240-240v-480h80v480h-80Zm440 0L400-480l280-240v480Z" />
                </svg>
            </button>
            <div class="media-player__progress">
                <input type="range" class="progress-slider" min="0" max="100" value="0">
            </div>
            <button class="media-player__next" title="Next">
                <svg viewBox="0 -960 960 960">
                    <path d="M640-240v-480h80v480h-80ZM280-240v-480l280 240-280 240Z" />
                </svg>
            </button>
            <button class="media-player__like" title="Like">
                <svg viewBox="0 -960 960 960">
                    <path
                        d="M720-120H280v-520l280-280 50 50q7 7 11.5 19t4.5 23v14l-44 174h258q32 0 56 24t24 56v80q0 7-2 15t-4 15L794-168q-9 20-30 34t-44 14Zm-360-80h360l120-280v-80H480l54-220-174 174v406Zm0-406v406-406Zm-80-34v80H160v360h120v80H80v-520h200Z" />
                </svg>
            </button>
            <button class="media-player__random" title="Random">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.45 20 9.5V4h-5.5zm.59 11.59l-1.41-1.41-1.42 1.41 1.42 1.41 1.41-1.41z" />
                </svg>
            </button>
        </article>
    </section>

    <audio id="audio-player"></audio>

    <script type="module">
        import { MediaPlayerCore } from '../scripts/media/MediaPlayerCore.js';
        import { UI } from '../scripts/media/MediaPlayerUI.js';
        import { SVG_PATHS } from '../scripts/media/Constants.js';

        const audio = document.getElementById('audio-player');
        const core = new MediaPlayerCore(audio);

        const container = document.querySelector('.media-player-grid');
        const titleEl = document.querySelector('.media-player__meta__title');
        const artistEl = document.querySelector('.media-player__meta__artist');
        const albumEl = document.querySelector('.media-player__meta__album');
        const playBtn = document.querySelector('.media-player__play-pause');
        const prevBtn = document.querySelector('.media-player__prev');
        const nextBtn = document.querySelector('.media-player__next');
        const likeBtn = document.querySelector('.media-player__like');
        const randomBtn = document.querySelector('.media-player__random');
        const slider = document.querySelector('.progress-slider');

        // State
        let isLiked = false;
        let isRandom = false;

        // Subscriptions
        core.subscribe((event, data) => {
            if (event === 'trackChanged') {
                titleEl.textContent = data.title;
                artistEl.textContent = data.artist;
                albumEl.textContent = data.album || 'Unknown Album';
                slider.value = 0;
                UI.updateBackgroundArt(container, data);
                UI.applyAccentColor(container, data, '--themed-background');
            }
            if (event === 'play' || event === 'pause') {
                const iconPath = playBtn.querySelector('svg path');
                iconPath.setAttribute('d', audio.paused ? SVG_PATHS.PLAY : SVG_PATHS.PAUSE);
            }
        });

        // Time Update
        audio.addEventListener('timeupdate', () => {
            if (!audio.duration) return;
            const progress = (audio.currentTime / audio.duration) * 100;
            slider.value = progress;
        });

        slider.addEventListener('input', () => {
            if (!audio.duration) return;
            const time = (slider.value / 100) * audio.duration;
            audio.currentTime = time;
        });

        // Handlers
        playBtn.addEventListener('click', () => core.togglePlay());
        prevBtn.addEventListener('click', () => core.prev());
        nextBtn.addEventListener('click', () => core.next());

        likeBtn.addEventListener('click', () => {
            isLiked = !isLiked;
            const path = likeBtn.querySelector('svg path');
            path.setAttribute('d', isLiked ? SVG_PATHS.LIKE_FILLED : SVG_PATHS.LIKE);
            likeBtn.style.color = isLiked ? '#007bff' : 'white';
        });

        randomBtn.addEventListener('click', () => {
            isRandom = !isRandom;
            randomBtn.style.color = isRandom ? '#007bff' : 'white';
            if (isRandom) core.shuffle();
        });

        // Init
        core.loadTrack(0);
    </script>
</body>

</html>